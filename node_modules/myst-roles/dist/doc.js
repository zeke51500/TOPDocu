import { fileWarn, RuleId } from 'myst-common';
const REF_PATTERN = /^(.+?)<([^<>]+)>$/; // e.g. 'Labeled Document <doc>'
export const docRole = {
    name: 'doc',
    body: {
        type: String,
        required: true,
    },
    run(data, vfile) {
        const body = data.body;
        const match = REF_PATTERN.exec(body);
        const [, modified, rawLabel] = match !== null && match !== void 0 ? match : [];
        const url = rawLabel !== null && rawLabel !== void 0 ? rawLabel : body;
        fileWarn(vfile, 'Usage of the {doc} role is not recommended, use a markdown link to the file instead.', {
            source: 'role:doc',
            note: `For {doc}\`${body}\` use [${modified || ''}](${url})`,
            ruleId: RuleId.roleBodyCorrect,
        });
        const link = { type: 'link', url };
        if (modified)
            link.children = [{ type: 'text', value: modified.trim() }];
        return [link];
    },
};
